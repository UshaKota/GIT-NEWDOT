{
    "contents" : "library(xlsx)\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(stringr)\nlibrary(stringi)\nlibrary(tidyr)\nlibrary(reshape2)\nlibrary(zoo)\nlibrary(ggplot2)\nlibrary(vcd)\n# library(tmap)\n# library(ggmap)\n# library(mapdata)\n# library(maps)\n# library(png)\n# library(sp)\n# library(rworldmap)\n# library(maptools)\n# library(rgdal)\n\n\n\nfilename = \"dotnewData.RDS\"\n\n\nif(file.exists(filename)){\n  print(\"fileexists\")\n  #create dot survey response data set from the RDS\n  dotsr<-readRDS(filename)\n  \n} else{\n  \n  \n  dotsr <- data.table(read.csv(\"DOTCleanedData1.csv\",skip = 1,stringsAsFactors = F))\n  saveRDS(dotsr, \"dotnewData.RDS\")\n  \n}\n# #convert dotData to data table\n# dotsr<-data.table(dotsr,keep.rownames=TRUE)\n\n#to have an idea check how many vairables and type of variables the DOT data has\ndot.var.dt<-data.table(var.name = colnames(dotsr),var.type = sapply(dotsr,class))\n\n#*****************************************************\n#How does access to technology vary by gender?\n#What devices do you have access to?\n#How often do you actually use these devices?\n#Where do you most commonly use the devices you have access to?\n#How much access to do you have to the Internet?\n#How often do you actually use the Internet?\n#Where do you most commonly use the Internet?\n#What digital services/tools do you have access to?\n#Where do you most commonly use digital services?\n\n#****************************************************\n\n#rename the X column to ID\nrename(dotsr,replace = c(\"X\" = \"ID\"))\n\n\n#Get only relevant columns from the dot survey response data set\ndot.tech.gender.dt<-subset(dotsr, select = grepl(\"ID|Gender|Age|Location|Geo|What.devices|use.these.devices|most.commonly.use.the.devices|access.to.do.you.have.to.the.Internet|commonly.use.the.Internet|What.digital|commonly.use.digital\", names(dotsr)))\n\n#can I drop the rows with Gender..Male and Gender..Female. == NA\n\n#create factor variables for devices\ndevices<-matrix(c(\"Desktopcomputer\", \"Laptop\", \"Tablet\", \"Smartphone\", \"Featurerichmobilephone\",\"Basicmobilephone\"),ncol = 1, byrow=T)\ndevice<-as.table(devices)\n\n\nfreq.levels<- matrix(c(\"Multipletimes\", \"Onceaday\", \"Everyfewdays\", \"Onceaweek\",\"Onceeveryfewweeks\",\n                       \"Onceamonth\",\"Lessthanonceamonth\",\"Never\",\"Idontknow\"),ncol = 1, byrow = T)\n\nfreq<-as.table(freq.levels)\n#truncate lengthy col names using .. or ...and lengthyphrases\n\n#What devices do you have access to?\n#How often do you actually use these devices?\n#Where do you most commonly use the devices you have access to?\n#How much access to do you have to the Internet?\n#How often do you actually use the Internet?\n#Where do you most commonly use the Internet?\n#What digital services/tools do you have access to?\n#Where do you most commonly use digital services?\n\n###########################################################################\nnames(dot.tech.gender.dt) <- gsub(\"\\\\.\", \"\", names(dot.tech.gender.dt))\n\nnames(dot.tech.gender.dt) <- gsub(\"\\\\Agerange\", \"\", names(dot.tech.gender.dt))\n\nnames(dot.tech.gender.dt) <- gsub(\"Whatdevicesdoyouhaveaccessto\", \"acc.dev\", names(dot.tech.gender.dt))\n\nnames(dot.tech.gender.dt) <- gsub(\"\\\\Howoftendoyouactuallyusethesedevices\", \"dev.use.freq.\", names(dot.tech.gender.dt))\n\nnames(dot.tech.gender.dt) <- gsub(\"Wheredoyoumostcommonlyusethedevicesyouhaveaccessto\", \"use.loc.device.\", names(dot.tech.gender.dt))\n\n#How much access to do you have to the Internet\nnames(dot.tech.gender.dt) <- gsub(\"HowmuchaccesstodoyouhavetotheInternet\", \"acc.to.Internet.\", names(dot.tech.gender.dt))\n\n#HowoftendoyouactuallyusetheInternet\nnames(dot.tech.gender.dt) <- gsub(\"HowoftendoyouactuallyusetheInternet\", \"use.Internet.\", names(dot.tech.gender.dt))\n\n#Where do you most commonly use the Internet\nnames(dot.tech.gender.dt) <- gsub(\"WheredoyoumostcommonlyusetheInternet\", \"use.loc.Internet.\", names(dot.tech.gender.dt))\n\n##What digital services\nnames(dot.tech.gender.dt) <- gsub(\"Whatdigitalservices\", \"acc.digi.tools.\", names(dot.tech.gender.dt))\n\n#Where do you most commonly use digital services\nnames(dot.tech.gender.dt) <- gsub(\"Wheredoyoumostcommonlyusedigitalservices\", \"loc.use.digi.tools.\", names(dot.tech.gender.dt))\n\n\n#check what variables have been chosen for the research Q\n#to have an idea check how many vairables and type of variables the DOT data has\ndot.tech.gender.var.dt<-data.table(var.name = colnames(dot.tech.gender.dt),var.type = sapply(dot.tech.gender.dt,class))\n\n#remove NA values in all mandatory columns.Age, Gender, Location,columns 1:9\ndot.tech.gender.dt<-dot.tech.gender.dt[rowSums(is.na(dot.tech.gender.dt[,1:9, with = F]))==0,,drop =F]\n\ndot.tech.gender.dt.man<-dot.tech.gender.dt[,1:9, with=F,by = ID]\n\n#remove all NA rows in all other acc/use technology columns 10 :534\n\ndot.tech.gender.dt<-dot.tech.gender.dt[rowSums(is.na(dot.tech.gender.dt[,10:534, with = F])) !=434,,drop =F]\n\n#now the clean dot.tech.gender.dt dimensions are 548 x 534. so there were 19 such cases\nid.cols.acc <-colnames(dot.tech.gender.dt)[-grep(\"acc.dev\",names(dot.tech.gender.dt))]\n\n\ndot.tech.gender.dt.ac.m<-data.table(melt(dot.tech.gender.dt, id.vars = id.cols.acc, measure.vars = grep(\"acc.dev\",names(dot.tech.gender.dt),value=T ),\n                                         na.rm=T ,variable.name = \"dev.acc\", value.name = \"acc.freq\"))\n\n#http://stackoverflow.com/questions/28230360/using-grepl-in-r-to-match-string\ndot.tech.gender.dt.ac.m$device = apply(dot.tech.gender.dt.ac.m, 1, function(u){\n  bool = sapply(device[,1], function(x) grepl(x, u[['dev.acc']]))\n  if(any(bool)&(u[['acc.freq']] == 1)) device[bool] else NA\n})\n\n# \n# #add access.freq column\n# \ndot.tech.gender.dt.ac.m$dev.avail.freq = apply(dot.tech.gender.dt.ac.m, 1, function(u){\n  bool = sapply(freq[,1], function(x) grepl(x, u[['dev.acc']]))\n  if(any(bool) & (u[['acc.freq']] == 1)) freq[bool] else NA\n})\n\none.acc.case.m<-dot.tech.gender.dt.ac.m[ID ==43912947 , list(dev.acc,acc.freq,device,dev.avail.freq)]\n\n# # #dcast the access-freq table and drop acc:columns\n# # \n# #remove the measure cols and value cols from dcast formula\nid.cols.acc.m <- colnames(dot.tech.gender.dt.ac.m)[-grep(\"dev.acc|acc.freq\",names(dot.tech.gender.dt.ac.m))]\n\nf <- as.formula(paste(paste(id.cols.acc.m, collapse = \" + \"), \"~ dev.acc\"))\n\ndot.tech.gender.dt<-data.table(dcast(data =dot.tech.gender.dt.ac.m, f, value.var = \"acc.freq\",function(x) length(unique(x))))\n\none.acc.case.c<-dot.tech.gender.dt[ID ==43912947 ,list(device,dev.avail.freq)]\n\n#drop acc: columns..\n#http://stackoverflow.com/questions/24590341/removing-multiple-columns-from-r-data-table-with-parameter-for-columns-to-remove\n#dt[, (colsToDelete) := NULL]\n\ndot.tech.gender.dt<-dot.tech.gender.dt[, which(grepl(\"acc.dev\", colnames(dot.tech.gender.dt))):=NULL]\n#save it\ndot.tech.gender.dt.acc<-unique(dot.tech.gender.dt)\n\n#melt for use device and use freq. columns\nid.cols.use  <-colnames(dot.tech.gender.dt)[-grep(\"dev.use.freq.\",names(dot.tech.gender.dt))]\nmeasure.cols.use <- colnames(dot.tech.gender.dt)[grep(\"dev.use.freq.\",names(dot.tech.gender.dt))]\n\n\ndot.tech.gender.use.m<-data.table(melt(dot.tech.gender.dt, id.vars = id.cols.use, measure.vars = measure.cols.use,\n                                       na.rm=T ,variable.name = \"dev.use\", value.name = \"dev.use.freq\"))\n\n\n#one.use.case.m<-dot.tech.gender.use.m[ID ==43912947 , list(device,dev.avail.freq,dev.use)]\n\n\ndot.tech.gender.use.m$use.dev.freq =  apply(dot.tech.gender.use.m, 1, function(u){\n  \n  bool = sapply(freq[,1], function(x) grepl(x, u[['dev.use']]))\n  if(any(bool)) freq[bool] else NA\n})\n\ndot.tech.gender.use.m$device.use =  apply(dot.tech.gender.use.m, 1, function(u){\n  \n  bool = sapply(device[,1], function(x) grepl(x, u[['dev.use']]))\n  if(any(bool)) device[bool] else NA\n})\n\ndot.tech.gender.use.b<-dot.tech.gender.use.m\n\n#some people use devices that they do not have access to.. so add that using device as another device --\n#insert a row for the user when the using device does not match the access device\n\n\n#http://stackoverflow.com/questions/15347282/split-string-column-and-insert-as-multiple-new-rows\n\n#get the subset for use frequency\nid.cols.use.m <- colnames(dot.tech.gender.use.m)[-grep(\"dev.use|dev.use.freq\",names(dot.tech.gender.use.m))]\n\nf <- as.formula(paste(paste(id.cols.use.m, collapse = \" + \"), \"~ dev.use\"))\n\ndot.tech.gender.dt.k<-data.table(dcast(data =dot.tech.gender.use.m, f, value.var = \"dev.use.freq\",function(x) length(unique(x))))\n\n#drop the dev.use.freq. cols\n\ndot.tech.gender.dt<-dot.tech.gender.dt.k[, which(grepl(\"dev.use|dev.use.freq\", colnames(dot.tech.gender.dt))):=NULL]\n\n# one.use.case.c<-dot.tech.gender.use.m[ID ==43912947,list( device,dev.avail.freq,device.use,use.dev.freq)]\n# \nuse.case.m<-unique(dot.tech.gender.dt[,list( device.use,use.dev.freq), by = ID])\n\ncols<-c(\"device.use\", \"use.dev.freq\")\n#acc.case.mm<-unique(dot.tech.gender.dt[, !cols, with=FALSE,by = ID])\n\n\nacc.case.m<-unique(dot.tech.gender.dt[,list(Gender,GenderC, AgeRange, AgeC,LocationRespondent, device,dev.avail.freq), by = ID])\n\n# #rename to merge\nrename(use.case.m, replace = c(\"device.use\" = \"device\"))\n# \nk<-merge(acc.case.m,use.case.m, by = c(\"ID\", \"device\"), all.y=T)#-->this one creates NA values for mandatory columns 3:7\n \n\n#set.seed(1071)\n#mosaic(art, gp = shading_max, gp_args = list(n = 5000))\n\n\nt<-xtabs(~dev.avail.freq+GenderC+device, data=acc.case.m)\n#p<-mosaic(t, gp = shading_max,keep = F)\n\n#http://stackoverflow.com/questions/35399772/r-vcdmosaic-overlapping-labels?rq=1\n\np<-mosaic(~ dev.avail.freq +device , data=acc.case.m,subset = GenderC == \"male\", legend=FALSE, gp=shading_max,labeling= labeling_border(rot_labels = c(90,0,0,0), \n                                                                                                                                                                     just_labels = c(\"left\", \n                                                                                                                                                                                     \"center\", \n                                                                                                                                                                                     \"center\", \n                                                                                                                                                                                     \"center\")))\nprint(p)\n\n#https://learnr.wordpress.com/2009/03/29/ggplot2_marimekko_mosaic_chart/\n#http://stackoverflow.com/questions/22238278/fine-tuning-ggplot2s-geom-boxplot\n\n\n # re-level for mosaic display\npng(\"dev-acc-by-gender.png\", width = 1200, height = 800)\np1<-mosaic(~ dev.avail.freq + device + GenderC, data=acc.case.m, expected=~dev.avail.freq:GenderC + device, legend=FALSE, gp=shading_Friendly ,labeling= labeling_border(rot_labels = c(90,0,0,0), \n                                                                                                                                                                         just_labels = c(\"left\", \n                                                                                                                                                                                         \"center\", \n                                                                                                                                                                                         \"center\", \n                                                                                                                                                                                         \"center\")))\n\n\n\nprint(p1)\n\n#dev.copy(png,\"dev-acc-by-gender.png\") \ndev.off()\n\nk<-structable(t)\n\n\n\n",
    "created" : 1460787791120.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1601775793",
    "id" : "48FDCFEE",
    "lastKnownWriteTime" : 1461164473,
    "path" : "C:/Users/Usha/RAssignments/DOT/NewDOT/DOT-NewData-Anal.R",
    "project_path" : "DOT-NewData-Anal.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : true,
    "type" : "r_source"
}